#!/bin/bash

set -e

BOLD='\033[1m'
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo ""
echo -e "${BOLD}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${BOLD}  Pre-Commit Hook: Format & Lint Checks${NC}"
echo -e "${BOLD}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo ""

echo -e "${BOLD}ğŸ¨ Checking code formatting...${NC}"
if ! cargo fmt --check 2>&1 | tail -5; then
    echo ""
    echo -e "${RED}âœ— Code formatting issues found${NC}"
    echo -e "${YELLOW}  Fix with: cargo fmt${NC}"
    echo ""
    exit 1
fi
echo -e "${GREEN}âœ“ Formatting OK${NC}"
echo ""

echo -e "${BOLD}ğŸ“ Running clippy linter...${NC}"
if ! cargo clippy --all-targets --all-features -- -D warnings 2>&1 | tail -10; then
    echo ""
    echo -e "${RED}âœ— Clippy warnings found${NC}"
    echo -e "${YELLOW}  Review and fix clippy warnings above${NC}"
    echo ""
    exit 1
fi
echo -e "${GREEN}âœ“ Linting OK${NC}"
echo ""

echo -e "${BOLD}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${GREEN}âœ… Pre-commit checks passed!${NC}"
echo -e "${BOLD}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo ""
echo -e "${YELLOW}Next: Push to trigger full test validation${NC}"
echo ""
